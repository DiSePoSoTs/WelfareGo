[#ftl]
<!-- Generated by FTL -->
[#include 'variables.html']
[#if loadLiferayJs!false]
<script type="text/javascript">
	(function(){
		var plid = themeDisplay.getPlid();

		var nsShort = "${portletNamespace!'dummy_namespace'}",portletId='p_p_id_'+nsShort+'_';
	
		var refreshAzione=function(task_id) {
			var taskParameter = "";
			if(task_id!=null){
				taskParameter += "&task_id="+task_id;
			}
			updatePortlet(taskParameter);
		}

		var updatePortlet=function(taskParameter) {
			var url = "/c/portal/render_portlet?p_l_id=" + plid+ "&p_p_id="+nsShort+"&p_p_action=0&p_p_state=normal&p_p_mode=view"+taskParameter;
			url = url.replace('#','%23');
			var el = Ext.get(portletId);
			el.innerHTML='';
			el.load({
				loadMask:'Caricamento task ...',
				url : url,
				scripts : true,
				success:function(){
					log('removing namespace ${ns} (azione)');
					delete window.${ns};
					window.scrollTo(el.getX()-75,el.getY()-75);
				}
			});
		}
		
		${gns}.refreshAzione=refreshAzione;
		${gns}.updatePortlet=updatePortlet;
	})();
</script>
[/#if]
[#if taskIdError!false]
<script type="text/javascript">
	Ext.onReady(function(){
		Ext.Msg.alert('Azione : task non trovato', 'Impossibile trovare il task id : ${taskId}');
	});
</script>	
[#else]
<script type="text/javascript">
	${ns}.config.taskId="${taskId!'no task id'}",
	${ns}.config.form=${formConfig!'undefined'};
	${ns}.data.forms['${codForm}']=${formData};
	// [#list stores?keys as key]
	// ${ns}.data.stores['${key}']=${stores[key]};
	// [/#list]	
	
	log('creating ns ${ns} (azione)');
	
	Ext.application({
		name: '${ns}',
		appFolder: '${nsFilterPath}/${ns}/app',
		controllers: [ ${ns}.config.form.controller ],
		launch: function() {
			Ext.create( '${ns}.'+${ns}.config.form.panel , {
            renderTo:'${ns}_azione_panel'
			});
		}
	});
</script>
<div id="${ns}_azione_panel"><!--<div class="loading-animation"></div>--></div>
[/#if]
<!-- Generated by FTL -->